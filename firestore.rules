/**
 * @fileoverview Firestore Security Rules for the St. Lucia Elections Hub application.
 *
 * Core Philosophy:
 * This ruleset provides open read access to all collections and restricts write access.
 * All write operations (`create`, `update`, `delete`) require authentication via `request.auth != null`.
 * No schema validation is performed in this initial prototyping phase beyond checking authentication.
 *
 * Data Structure:
 * - `/parties/{partyId}`: Stores political party information.
 * - `/candidates/{candidateId}`: Stores candidate information.
 * - `/elections/{electionId}`: Stores election event information.
 * - `/polling_data/{pollingDataId}`: Stores polling data for elections.
 * - `/constituencies/{constituencyId}`: Stores constituency information.
 * - `/election_results/{electionResultId}`: Stores election result information.
 * - `/settings/pageLayouts`: Stores page layouts settings.
 *
 * Key Security Decisions:
 * - Read access is public for all collections.
 * - All write operations require authentication.
 * - No data validation is performed beyond authentication.
 * - List operations are public for all collections.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows public read access and authenticated write access to party data.
     * @path /parties/{partyId}
     * @allow (get, list): Always.
     * @allow (create, update, delete): Only if the user is authenticated.
     * @deny (create, update, delete): If the user is not authenticated.
     * @principle Allows anyone to read party information, but only authenticated users can modify it.
     */
    match /parties/{partyId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows public read access and authenticated write access to candidate data.
     * @path /candidates/{candidateId}
     * @allow (get, list): Always.
     * @allow (create, update, delete): Only if the user is authenticated.
     * @deny (create, update, delete): If the user is not authenticated.
     * @principle Allows anyone to read candidate information, but only authenticated users can modify it.
     */
    match /candidates/{candidateId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows public read access and authenticated write access to election data.
     * @path /elections/{electionId}
     * @allow (get, list): Always.
     * @allow (create, update, delete): Only if the user is authenticated.
     * @deny (create, update, delete): If the user is not authenticated.
     * @principle Allows anyone to read election information, but only authenticated users can modify it.
     */
    match /elections/{electionId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows public read access and authenticated write access to polling data.
     * @path /polling_data/{pollingDataId}
     * @allow (get, list): Always.
     * @allow (create, update, delete): Only if the user is authenticated.
     * @deny (create, update, delete): If the user is not authenticated.
     * @principle Allows anyone to read polling data, but only authenticated users can modify it.
     */
    match /polling_data/{pollingDataId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows public read access and authenticated write access to constituency data.
     * @path /constituencies/{constituencyId}
     * @allow (get, list): Always.
     * @allow (create, update, delete): Only if the user is authenticated.
     * @deny (create, update, delete): If the user is not authenticated.
     * @principle Allows anyone to read constituency information, but only authenticated users can modify it.
     */
    match /constituencies/{constituencyId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows public read access and authenticated write access to election result data.
     * @path /election_results/{electionResultId}
     * @allow (get, list): Always.
     * @allow (create, update, delete): Only if the user is authenticated.
     * @deny (create, update, delete): If the user is not authenticated.
     * @principle Allows anyone to read election results, but only authenticated users can modify it.
     */
    match /election_results/{electionResultId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows public read access and authenticated write access to page layout settings.
     * @path /settings/pageLayouts
     * @allow (get, list): Always.
     * @allow (create, update, delete): Only if the user is authenticated.
     * @deny (create, update, delete): If the user is not authenticated.
     * @principle Allows anyone to read the page layout settings, but only authenticated users can modify them.
     */
    match /settings/pageLayouts {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    // --- Helper Functions ---
    function isSignedIn() {
      return request.auth != null;
    }
  }
}