/**
 * @file Firestore Security Rules
 * @description This ruleset enforces a public-read, restricted-write model for most data,
 *  with some exceptions for user-generated content and administrative settings.
 *
 * Data Structure:
 * - Top-level collections generally represent public data (e.g., parties, candidates, constituencies).
 * - Documents nested under /news/{newsId} allow for article-specific data (e.g., comments).
 * - The /settings collection contains singleton documents for global configurations.
 *
 * Key Security Decisions:
 * - Mailing list subscribers are write-protected for now.
 * - Site settings and page layouts can't be modified via client.
 * - Public read access is granted where appropriate to facilitate data consumption.
 *
 * Access Control Patterns:
 * - Public Read with Owner-Only Writes: Used for top-level collections intended for public consumption where authors must retain control.
 * - Nested data: Data nested under a parent document will inherit the security rules of the parent.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows anyone to read the voter information. Writing is disallowed for now.
     * @path /databases/{database}/documents/voter_information/{infoId}
     * @allow get, list: if true
     * @deny create, update, delete: if false
     * @principle Public read access.
     */
    match /voter_information/{infoId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read constituency projection data. Writing is disallowed for now.
     * @path /databases/{database}/documents/constituency_projections/{projectionId}
     * @allow get, list: if true
     * @deny create, update, delete: if false
     * @principle Public read access.
     */
    match /constituency_projections/{projectionId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Rules for reported comments.  No writes allowed from client side.
     * @path /databases/{database}/documents/reports/{reportId}
     * @allow get, list: if false
     * @deny create, update, delete: if false
     * @principle No client writes.
     */
    match /reports/{reportId} {
      allow get, list: if false;
      allow create, update, delete: if false;
    }
   /**
     * @description Allows anyone to read news articles. Writing is disallowed for now.
     * @path /databases/{database}/documents/news/{newsId}
     * @allow get, list: if true
     * @deny create, update, delete: if false
     * @principle Public read access.
     */
    match /news/{newsId} {
        allow get, list: if true;
        allow create, update, delete: if false;

        /**
         * @description Rules for comments under a news article.  No writes allowed from client side.
         * @path /databases/{database}/documents/news/{newsId}/comments/{commentId}
         * @allow get, list: if false
         * @deny create, update, delete: if false
         * @principle No client writes.
         */
        match /comments/{commentId} {
            allow get, list: if false;
            allow create, update, delete: if false;
        }
    }

    /**
     * @description Allows anyone to read ads. Writing is disallowed for now.
     * @path /databases/{database}/documents/ads/{adId}
     * @allow get, list: if true
     * @deny create, update, delete: if false
     * @principle Public read access.
     */
    match /ads/{adId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read user maps. Writing is disallowed for now.
     * @path /databases/{database}/documents/user_maps/{userMapId}
     * @allow get, list: if true
     * @deny create, update, delete: if false
     * @principle Public read access.
     */
    match /user_maps/{userMapId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read region data. Writing is disallowed for now.
     * @path /databases/{database}/documents/regions/{regionId}
     * @allow get, list: if true
     * @deny create, update, delete: if false
     * @principle Public read access.
     */
    match /regions/{regionId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read user activity, but writing is disallowed.
     * @path /databases/{database}/documents/user_activity/{activityId}
     * @allow get, list: if true
     * @deny create, update, delete: if false
     * @principle Public read access.
     */
    match /user_activity/{activityId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Disallows any access to site settings.
     * @path /databases/{database}/documents/settings/site
     * @deny get, list, create, update, delete: if false
     * @principle No client access to settings.
     */
    match /settings/site {
      allow get, list, create, update, delete: if false;
    }

    /**
     * @description Disallows any access to page layouts.
     * @path /databases/{database}/documents/settings/pageLayouts
     * @deny get, list, create, update, delete: if false
     * @principle No client access to settings.
     */
    match /settings/pageLayouts {
      allow get, list, create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read election results. Writing is disallowed for now.
     * @path /databases/{database}/documents/election_results/{electionResultId}
     * @allow get, list: if true
     * @deny create, update, delete: if false
     * @principle Public read access.
     */
    match /election_results/{electionResultId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read constituency data. Writing is disallowed for now.
     * @path /databases/{database}/documents/constituencies/{constituencyId}
     * @allow get, list: if true
     * @deny create, update, delete: if false
     * @principle Public read access.
     */
    match /constituencies/{constituencyId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read polling data. Writing is disallowed for now.
     * @path /databases/{database}/documents/polling_data/{pollingDataId}
     * @allow get, list: if true
     * @deny create, update, delete: if false
     * @principle Public read access.
     */
    match /polling_data/{pollingDataId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read election data. Writing is disallowed for now.
     * @path /databases/{database}/documents/elections/{electionId}
     * @allow get, list: if true
     * @deny create, update, delete: if false
     * @principle Public read access.
     */
    match /elections/{electionId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read archived candidate data. Writing is disallowed for now.
     * @path /databases/{database}/documents/archived_candidates/{archivedCandidateId}
     * @allow get, list: if true
     * @deny create, update, delete: if false
     * @principle Public read access.
     */
    match /archived_candidates/{archivedCandidateId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read candidate data. Writing is disallowed for now.
     * @path /databases/{database}/documents/candidates/{candidateId}
     * @allow get, list: if true
     * @deny create, update, delete: if false
     * @principle Public read access.
     */
    match /candidates/{candidateId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read event data. Writing is disallowed for now.
     * @path /databases/{database}/documents/events/{eventId}
     * @allow get, list: if true
     * @deny create, update, delete: if false
     * @principle Public read access.
     */
    match /events/{eventId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read party logo data. Writing is disallowed for now.
     * @path /databases/{database}/documents/party_logos/{partyLogoId}
     * @allow get, list: if true
     * @deny create, update, delete: if false
     * @principle Public read access.
     */
    match /party_logos/{partyLogoId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read party data. Writing is disallowed for now.
     * @path /databases/{database}/documents/parties/{partyId}
     * @allow get, list: if true
     * @deny create, update, delete: if false
     * @principle Public read access.
     */
    match /parties/{partyId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

     /**
      * @description Disallows any access to mailing list subscribers
      * @path /databases/{database}/documents/mailing_list_subscribers/{subscriberId}
      * @deny get, list, create, update, delete: if false
      * @principle No client access to mailing list subscribers
      */
    match /mailing_list_subscribers/{subscriberId} {
      allow get, list, create, update, delete: if false;
    }
  }
}