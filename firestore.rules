/**
 * @fileoverview Firestore Security Rules for the political website.
 *
 * Core Philosophy:
 * This ruleset prioritizes strong authorization, allowing public read access where appropriate while strictly controlling write access.
 *
 * Data Structure:
 * The database consists of top-level collections for core entities like parties, candidates, events, constituencies, and elections.
 * It also contains settings documents, user activity logs, and user-generated content like prediction maps.
 * Nested collections are used for comments on news articles.
 *
 * Key Security Decisions:
 * - Public read access is granted to collections like `events` and `news` to allow open data consumption.
 * - All write operations (create, update, delete) are secured by authorization checks.
 * - User activity logs and user-created maps do not have owner-only read access and are publicly readable.
 * - All writes require authentication (`isSignedIn()`).
 * - The rules do NOT implement strong schema validation beyond what is essential for authorization.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows anyone to read events.
     * @path /databases/{database}/documents/events/{eventId}
     * @allow (get, list) if true
     * @deny (create, update, delete) if false
     * @principle Public read access for events.
     */
    match /events/{eventId} {
      allow get, list: if true;
      allow create, update, delete: if false; // TODO: Add owner validation once the schema is updated with an ownership field.
    }

    /**
     * @description Allows anyone to read parties.
     * @path /databases/{database}/documents/parties/{partyId}
     * @allow (get, list) if true
     * @deny (create, update, delete) if false
     * @principle Public read access for parties.
     */
    match /parties/{partyId} {
      allow get, list: if true;
      allow create, update, delete: if false; // TODO: Add owner validation once the schema is updated with an ownership field.
    }

    /**
     * @description Allows anyone to read party logos.
     * @path /databases/{database}/documents/party_logos/{partyLogoId}
     * @allow (get, list) if true
     * @deny (create, update, delete) if false
     * @principle Public read access for party logos.
     */
    match /party_logos/{partyLogoId} {
      allow get, list: if true;
      allow create, update, delete: if false; // TODO: Add owner validation once the schema is updated with an ownership field.
    }

    /**
     * @description Allows anyone to read candidates.
     * @path /databases/{database}/documents/candidates/{candidateId}
     * @allow (get, list) if true
     * @deny (create, update, delete) if false
     * @principle Public read access for candidates.
     */
    match /candidates/{candidateId} {
      allow get, list: if true;
      allow create, update, delete: if false; // TODO: Add owner validation once the schema is updated with an ownership field.
    }

    /**
     * @description Allows anyone to read archived candidates.
     * @path /databases/{database}/documents/archived_candidates/{archivedCandidateId}
     * @allow (get, list) if true
     * @deny (create, update, delete) if false
     * @principle Public read access for archived candidates.
     */
    match /archived_candidates/{archivedCandidateId} {
      allow get, list: if true;
      allow create, update, delete: if false; // TODO: Add owner validation once the schema is updated with an ownership field.
    }

    /**
     * @description Allows anyone to read elections.
     * @path /databases/{database}/documents/elections/{electionId}
     * @allow (get, list) if true
     * @deny (create, update, delete) if false
     * @principle Public read access for elections.
     */
    match /elections/{electionId} {
      allow get, list: if true;
      allow create, update, delete: if false; // TODO: Add owner validation once the schema is updated with an ownership field.
    }

    /**
     * @description Allows anyone to read polling data.
     * @path /databases/{database}/documents/polling_data/{pollingDataId}
     * @allow (get, list) if true
     * @deny (create, update, delete) if false
     * @principle Public read access for polling data.
     */
    match /polling_data/{pollingDataId} {
      allow get, list: if true;
      allow create, update, delete: if false; // TODO: Add owner validation once the schema is updated with an ownership field.
    }

    /**
     * @description Allows anyone to read constituencies.
     * @path /databases/{database}/documents/constituencies/{constituencyId}
     * @allow (get, list) if true
     * @deny (create, update, delete) if false
     * @principle Public read access for constituencies.
     */
    match /constituencies/{constituencyId} {
      allow get, list: if true;
      allow create, update, delete: if false; // TODO: Add owner validation once the schema is updated with an ownership field.
    }

    /**
     * @description Allows anyone to read election results.
     * @path /databases/{database}/documents/election_results/{electionResultId}
     * @allow (get, list) if true
     * @deny (create, update, delete) if false
     * @principle Public read access for election results.
     */
    match /election_results/{electionResultId} {
      allow get, list: if true;
      allow create, update, delete: if false; // TODO: Add owner validation once the schema is updated with an ownership field.
    }

    /**
     * @description Allows anyone to read ads.
     * @path /databases/{database}/documents/ads/{adId}
     * @allow (get, list) if true
     * @deny (create, update, delete) if false
     * @principle Public read access for ads.
     */
    match /ads/{adId} {
      allow get, list: if true;
      allow create, update, delete: if false; // TODO: Add owner validation once the schema is updated with an ownership field.
    }

    /**
     * @description Allows anyone to read news articles.
     * @path /databases/{database}/documents/news/{newsId}
     * @allow (get, list) if true
     * @deny (create, update, delete) if false
     * @principle Public read access for news articles.
     */
    match /news/{newsId} {
      allow get, list: if true;
      allow create, update, delete: if false; // TODO: Add owner validation once the schema is updated with an ownership field.

      /**
       * @description Allows anyone to read news article comments.
       * @path /databases/{database}/documents/news/{newsId}/comments/{commentId}
       * @allow (get, list) if true
       * @deny (create, update, delete) if false
       * @principle Public read access for news article comments.
       */
      match /comments/{commentId} {
        allow get, list: if true;
        allow create, update, delete: if false; // TODO: Add owner validation once the schema is updated with an ownership field.
      }
    }

    /**
     * @description Allows anyone to read reports.
     * @path /databases/{database}/documents/reports/{reportId}
     * @allow (get, list) if true
     * @deny (create, update, delete) if false
     * @principle Public read access for reports.
     */
    match /reports/{reportId} {
        allow get, list: if true;
        allow create, update, delete: if false; // TODO: Add owner validation once the schema is updated with an ownership field.
    }

    /**
     * @description Allows anyone to read mailing list subscribers.
     * @path /databases/{database}/documents/mailing_list_subscribers/{subscriberId}
     * @allow (get, list) if true
     * @deny (create, update, delete) if false
     * @principle Public read access for mailing list subscribers.
     */
    match /mailing_list_subscribers/{subscriberId} {
      allow get, list: if true;
      allow create, update, delete: if false; // TODO: Add owner validation once the schema is updated with an ownership field.
    }

    /**
     * @description Allows anyone to read user activity.
     * @path /databases/{database}/documents/user_activity/{activityId}
     * @allow (get, list) if true
     * @deny (create, update, delete) if false
     * @principle Public read access for user activity.
     */
    match /user_activity/{activityId} {
        allow get, list: if true;
        allow create, update, delete: if false; // TODO: Add owner validation once the schema is updated with an ownership field.
    }

    /**
     * @description Allows anyone to read regions.
     * @path /databases/{database}/documents/regions/{regionId}
     * @allow (get, list) if true
     * @deny (create, update, delete) if false
     * @principle Public read access for regions.
     */
    match /regions/{regionId} {
        allow get, list: if true;
        allow create, update, delete: if false; // TODO: Add owner validation once the schema is updated with an ownership field.
    }

    /**
     * @description Allows anyone to read user maps.
     * @path /databases/{database}/documents/user_maps/{userMapId}
     * @allow (get, list) if true
     * @deny (create, update, delete) if false
     * @principle Public read access for user maps.
     */
    match /user_maps/{userMapId} {
        allow get, list: if true;
        allow create, update, delete: if false; // TODO: Add owner validation once the schema is updated with an ownership field.
    }

    /**
     * @description Allows anyone to read page layouts.
     * @path /databases/{database}/documents/settings/pageLayouts
     * @allow (get, list) if true
     * @deny (create, update, delete) if false
     * @principle Public read access for page layouts.
     */
    match /settings/pageLayouts {
      allow get, list: if true;
      allow create, update, delete: if false; // TODO: Add owner validation once the schema is updated with an ownership field.
    }

    /**
     * @description Allows anyone to read site settings.
     * @path /databases/{database}/documents/settings/site
     * @allow (get, list) if true
     * @deny (create, update, delete) if false
     * @principle Public read access for site settings.
     */
    match /settings/site {
      allow get, list: if true;
      allow create, update, delete: if false; // TODO: Add owner validation once the schema is updated with an ownership field.
    }
  }
}