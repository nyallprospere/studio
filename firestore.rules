/**
 * @file Firestore Security Rules
 * @description This ruleset is in prototyping mode, focusing on strong authorization
 *   while relaxing data validation to allow for rapid iteration.
 *
 * Core Philosophy:
 *   - Authenticated users can create, read, update, and delete data.

 *
 * Data Structure:
 *   - Top-level collections store core entities: parties, events, candidates, etc.
 *   - The document ID is used as the unique identifier for each entity.
 *   - Ads can be created by any authenticated user.
 *
 * Key Security Decisions:
 *   - All write operations are restricted to authenticated users.
 *   - List operations default to owner-only access for user-scoped data.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Checks if the request is authenticated.
     * @path N/A
     * @allow N/A
     * @deny N/A
     * @principle Requires authentication for access.
     */
    function isSignedIn() {
      return request.auth != null;
    }

    /**
     * @description Allows access only to the owner of the data.
     * @path N/A
     * @allow N/A
     * @deny N/A
     * @principle Enforces data ownership.
     */
    function isOwner(userId) {
      return request.auth.uid == userId;
    }

    /**
     * @description Allows access only to the owner of the data. Checks for data existence.
     * @path N/A
     * @allow N/A
     * @deny N/A
     * @principle Enforces data ownership.
     */
    function isExistingOwner(userId) {
      return isOwner(userId) && existsAfter(/databases/$(database)/documents/);
    }

    /**
     * @description Rules for the /mailing_list_subscribers collection.
     * @path /mailing_list_subscribers/{subscriberId}
     * @allow (create) - Any authenticated user can create a subscriber.
     * @deny (create) - Not authenticated.
     * @principle Requires authentication for all write operations.
     */
    match /mailing_list_subscribers/{subscriberId} {
      allow get: if isSignedIn();
      allow list: if false;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Rules for the /parties collection.
     * @path /parties/{partyId}
     * @allow (create) - Any authenticated user can create a party.
     * @deny (create) - Not authenticated.
     * @principle Requires authentication for all write operations.
     */
    match /parties/{partyId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Rules for the /party_logos collection.
     * @path /party_logos/{partyLogoId}
     * @allow (create) - Any authenticated user can create a party logo.
     * @deny (create) - Not authenticated.
     * @principle Requires authentication for all write operations.
     */
    match /party_logos/{partyLogoId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Rules for the /events collection.
     * @path /events/{eventId}
     * @allow (create) - Any authenticated user can create an event.
     * @deny (create) - Not authenticated.
     * @principle Requires authentication for all write operations.
     */
    match /events/{eventId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Rules for the /candidates collection.
     * @path /candidates/{candidateId}
     * @allow (create) - Any authenticated user can create a candidate.
     * @deny (create) - Not authenticated.
     * @principle Requires authentication for all write operations.
     */
    match /candidates/{candidateId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Rules for the /archived_candidates collection.
     * @path /archived_candidates/{archivedCandidateId}
     * @allow (create) - Any authenticated user can create an archived candidate.
     * @deny (create) - Not authenticated.
     * @principle Requires authentication for all write operations.
     */
    match /archived_candidates/{archivedCandidateId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Rules for the /elections collection.
     * @path /elections/{electionId}
     * @allow (create) - Any authenticated user can create an election.
     * @deny (create) - Not authenticated.
     * @principle Requires authentication for all write operations.
     */
    match /elections/{electionId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Rules for the /polling_data collection.
     * @path /polling_data/{pollingDataId}
     * @allow (create) - Any authenticated user can create polling data.
     * @deny (create) - Not authenticated.
     * @principle Requires authentication for all write operations.
     */
    match /polling_data/{pollingDataId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Rules for the /constituencies collection.
     * @path /constituencies/{constituencyId}
     * @allow (create) - Any authenticated user can create a constituency.
     * @deny (create) - Not authenticated.
     * @principle Requires authentication for all write operations.
     */
    match /constituencies/{constituencyId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Rules for the /election_results collection.
     * @path /election_results/{electionResultId}
     * @allow (create) - Any authenticated user can create an election result.
     * @deny (create) - Not authenticated.
     * @principle Requires authentication for all write operations.
     */
    match /election_results/{electionResultId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Rules for the /settings/pageLayouts document.
     * @path /settings/pageLayouts
     * @allow (get) - Anyone can get the page layouts.
     * @allow (create) - Only authenticated users can create the document.
     * @deny (create) - Not authenticated.
     * @principle Requires authentication for all write operations.
     */
    match /settings/pageLayouts {
      allow get: if true;
      allow list: if false;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Rules for the /settings/site document.
     * @path /settings/site
     * @allow (get) - Anyone can get the site settings.
     * @allow (create) - Only authenticated users can create the document.
     * @deny (create) - Not authenticated.
     * @principle Requires authentication for all write operations.
     */
    match /settings/site {
      allow get: if true;
      allow list: if false;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Rules for the /user_activity collection.
     * @path /user_activity/{activityId}
     * @allow (create) - Any authenticated user can create an activity event.
     * @deny (create) - Not authenticated.
     * @principle Requires authentication for all write operations.
     */
    match /user_activity/{activityId} {
      allow get: if isSignedIn();
      allow list: if false;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Rules for the /regions collection.
     * @path /regions/{regionId}
     * @allow (create) - Any authenticated user can create a region.
     * @deny (create) - Not authenticated.
     * @principle Requires authentication for all write operations.
     */
    match /regions/{regionId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Rules for the /user_maps collection.
     * @path /user_maps/{userMapId}
     * @allow (create) - Any authenticated user can create a user map.
     * @deny (create) - Not authenticated.
     * @principle Requires authentication for all write operations.
     */
    match /user_maps/{userMapId} {
      allow get: if isSignedIn();
      allow list: if false;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Rules for the /ads collection.
     * @path /ads/{adId}
     * @allow (create) - Any authenticated user can create an ad.
     * @deny (create) - Not authenticated.
     * @principle Requires authentication for all write operations.
     */
    match /ads/{adId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }
  }
}