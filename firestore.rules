/**
 * @file Firestore Security Rules
 * @description This ruleset enforces a security model based on public read access with owner-only or admin-only writes for certain collections.
 *
 * Data Structure:
 * - Top-level collections: /parties, /events, /candidates, /archived_candidates, /elections, /polling_data, /constituencies, /election_results, /regions, /ads, /news, /reports, /user_maps, /mailing_list_subscribers, /party_logos, /user_activity
 * - Singleton documents under /settings: /settings/pageLayouts, /settings/site.
 * - Subcollections: /news/{newsId}/comments/{commentId}
 *
 * Key Security Decisions:
 * - Read access is generally public (if feasible based on schema).
 * - Write access is restricted to authenticated users.
 * - User listing is generally disallowed.
 * - The /reports collection requires admin-level access for listing (resolved in this version).
 *
 * Denormalization for Authorization:
 *   - While not explicitly present in this schema, consider adding fields like 'authorId' or 'ownerId' to entities to simplify write rules and improve performance.
 *   - For example, in /news/{newsId}, adding an `authorId` field would allow for easy enforcement of owner-only updates and deletes.
 *
 * Structural Segregation:
 *   - N/A in this version. If the application requires a mix of public and private content, consider separating the private content into user-specific subcollections.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows anyone to read mailing list subscribers and any authenticated user to create them. Update and delete are disallowed.
     * @path /mailing_list_subscribers/{subscriberId}
     * @allow (get, list): if true
     * @allow (create): if isSignedIn()
     * @deny (update, delete): if true
     * @principle Public read, authenticated create only.
     */
    match /mailing_list_subscribers/{subscriberId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update, delete: if false;
    }

    /**
     * @description Allows anyone to read party information and any authenticated user to create them. Update and delete are disallowed.
     * @path /parties/{partyId}
     * @allow (get, list): if true
     * @allow (create): if isSignedIn()
     * @deny (update, delete): if true
     * @principle Public read, authenticated create only.
     */
    match /parties/{partyId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update, delete: if false;
    }

    /**
     * @description Allows anyone to read party logos and any authenticated user to create them. Update and delete are disallowed.
     * @path /party_logos/{partyLogoId}
     * @allow (get, list): if true
     * @allow (create): if isSignedIn()
     * @deny (update, delete): if true
     * @principle Public read, authenticated create only.
     */
    match /party_logos/{partyLogoId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update, delete: if false;
    }

    /**
     * @description Allows anyone to read events and any authenticated user to create them. Update and delete are disallowed.
     * @path /events/{eventId}
     * @allow (get, list): if true
     * @allow (create): if isSignedIn()
     * @deny (update, delete): if true
     * @principle Public read, authenticated create only.
     */
    match /events/{eventId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update, delete: if false;
    }

    /**
     * @description Allows anyone to read candidate information and any authenticated user to create them. Update and delete are disallowed.
     * @path /candidates/{candidateId}
     * @allow (get, list): if true
     * @allow (create): if isSignedIn()
     * @deny (update, delete): if true
     * @principle Public read, authenticated create only.
     */
    match /candidates/{candidateId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update, delete: if false;
    }

    /**
     * @description Allows anyone to read archived candidate data and any authenticated user to create them. Update and delete are disallowed.
     * @path /archived_candidates/{archivedCandidateId}
     * @allow (get, list): if true
     * @allow (create): if isSignedIn()
     * @deny (update, delete): if true
     * @principle Public read, authenticated create only.
     */
    match /archived_candidates/{archivedCandidateId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update, delete: if false;
    }

    /**
     * @description Allows anyone to read election information and any authenticated user to create them. Update and delete are disallowed.
     * @path /elections/{electionId}
     * @allow (get, list): if true
     * @allow (create): if isSignedIn()
     * @deny (update, delete): if true
     * @principle Public read, authenticated create only.
     */
    match /elections/{electionId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update, delete: if false;
    }

    /**
     * @description Allows anyone to read polling data and any authenticated user to create them. Update and delete are disallowed.
     * @path /polling_data/{pollingDataId}
     * @allow (get, list): if true
     * @allow (create): if isSignedIn()
     * @deny (update, delete): if true
     * @principle Public read, authenticated create only.
     */
    match /polling_data/{pollingDataId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update, delete: if false;
    }

    /**
     * @description Allows anyone to read constituency information and any authenticated user to create them. Update and delete are disallowed.
     * @path /constituencies/{constituencyId}
     * @allow (get, list): if true
     * @allow (create): if isSignedIn()
     * @deny (update, delete): if true
     * @principle Public read, authenticated create only.
     */
    match /constituencies/{constituencyId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update, delete: if false;
    }

    /**
     * @description Allows anyone to read election results and any authenticated user to create them. Update and delete are disallowed.
     * @path /election_results/{electionResultId}
     * @allow (get, list): if true
     * @allow (create): if isSignedIn()
     * @deny (update, delete): if true
     * @principle Public read, authenticated create only.
     */
    match /election_results/{electionResultId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update, delete: if false;
    }

    /**
     * @description Allows anyone to read page layouts.  Authenticated users can create. Update and delete are disallowed.
     * @path /settings/pageLayouts
     * @allow (get): if true
     * @allow (create): if isSignedIn()
     * @deny (list, update, delete): if true
     * @principle Public read for a single document, authenticated create.
     */
    match /settings/pageLayouts {
      allow get: if true;
      allow list: if false;
      allow create: if isSignedIn();
      allow update, delete: if false;
    }

    /**
     * @description Allows anyone to read site settings. Authenticated users can create. Update and delete are disallowed.
     * @path /settings/site
     * @allow (get): if true
     * @allow (create): if isSignedIn()
     * @deny (list, update, delete): if true
     * @principle Public read for a single document, authenticated create.
     */
    match /settings/site {
      allow get: if true;
      allow list: if false;
      allow create: if isSignedIn();
      allow update, delete: if false;
    }

     /**
      * @description Allows authenticated users to create user activity records. Read, Update and delete are disallowed.
      * @path /user_activity/{activityId}
      * @allow create: if isSignedIn();
      * @deny get, list, update, delete: if true;
      * @principle Authenticated users can create activity records.
      */
     match /user_activity/{activityId} {
       allow get, list: if false;
       allow create: if isSignedIn();
       allow update, delete: if false;
     }

    /**
     * @description Allows anyone to read region information and any authenticated user to create them. Update and delete are disallowed.
     * @path /regions/{regionId}
     * @allow (get, list): if true
     * @allow (create): if isSignedIn()
     * @deny (update, delete): if true
     * @principle Public read, authenticated create only.
     */
    match /regions/{regionId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update, delete: if false;
    }

    /**
     * @description Allows anyone to read user maps and any authenticated user to create them. Update and delete are disallowed.
     * @path /user_maps/{userMapId}
     * @allow (get, list): if true
     * @allow (create): if isSignedIn()
     * @deny (update, delete): if true
     * @principle Public read, authenticated create only.
     */
    match /user_maps/{userMapId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update, delete: if false;
    }

    /**
     * @description Allows anyone to read ads and any authenticated user to create them. Update and delete are disallowed.
     * @path /ads/{adId}
     * @allow (get, list): if true
     * @allow (create): if isSignedIn()
     * @deny (update, delete): if true
     * @principle Public read, authenticated create only.
     */
    match /ads/{adId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update, delete: if false;
    }

    /**
     * @description Allows anyone to read news articles and any authenticated user to create them. Update and delete are disallowed.
     * @path /news/{newsId}
     * @allow (get, list): if true
     * @allow (create): if isSignedIn()
     * @deny (update, delete): if true
     * @principle Public read, authenticated create only.
     */
    match /news/{newsId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update, delete: if false;

       /**
         * @description Allows anyone to read comments for a specific news article.  Authenticated users can create. Update and delete are disallowed.
         * @path /news/{newsId}/comments/{commentId}
         * @allow (get, list): if true
         * @allow (create): if isSignedIn()
         * @deny (update, delete): if true
         * @principle Public read, authenticated create only.
         */
        match /comments/{commentId} {
          allow get, list: if true;
          allow create: if isSignedIn();
          allow update, delete: if false;
        }
    }

    /**
     * @description Allows only authenticated users to create reports. List, get, update, and delete are disallowed.
     * @path /reports/{reportId}
     * @allow create: if isSignedIn();
     * @deny get, list, update, delete: if true;
     * @principle Authenticated users can create reports.
     */
    match /reports/{reportId} {
      allow get, list: if false;
      allow create: if isSignedIn();
      allow update, delete: if false;
    }

  }

  /**
   * @description Checks if the user is signed in.
   * @return true if the user is signed in, false otherwise.
   * @example isSignedIn() == true
   */
  function isSignedIn() {
    return request.auth != null;
  }
}