/**
 * @fileoverview Firestore Security Rules for St. Lucia Elections Hub.
 *
 * Core Philosophy:
 * This ruleset provides a flexible security posture that allows any authenticated user to read data. Write access is not explicitly defined, so it is denied by default. This facilitates rapid prototyping, but it should be locked down for production.
 *
 * Data Structure:
 * - /parties/{partyId}: Stores political party information.
 * - /candidates/{candidateId}: Stores candidate information.
 * - /elections/{electionId}: Stores election event information.
 * - /polling_data/{pollingDataId}: Stores polling data for elections.
 * - /constituencies/{constituencyId}: Stores constituency information.
 * - /election_results/{electionResultId}: Stores election result information.
 *
 * Key Security Decisions:
 * - Read access is generally open to any signed-in user to facilitate data discovery and display.
 * - Write access is initially denied across the board to prevent accidental data modification. This must be explicitly granted and secured for production.
 * - Data validation is relaxed in this prototyping phase. In a production environment, data types, required fields, and valid values should be strictly enforced.
 * - List operations are generally allowed for signed-in users, but this should be reviewed on a per-collection basis in the future.
 *
 * Denormalization for Authorization:
 *  N/A. The current data model does not require denormalization for authorization, as there are no ownership or role-based access control requirements.
 *
 * Structural Segregation:
 *  N/A. All data is stored in top-level collections, which simplifies the ruleset.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows any signed-in user to read Party data. Denies all writes.
     * @path /parties/{partyId}
     * @allow (get, list): if isSignedIn()
     * @deny (create, update, delete): Always.
     * @principle Allows public read access for authenticated users, denies all writes.
     */
    match /parties/{partyId} {
      allow get, list: if isSignedIn();
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Allows any signed-in user to read Candidate data. Denies all writes.
     * @path /candidates/{candidateId}
     * @allow (get, list): if isSignedIn()
     * @deny (create, update, delete): Always.
     * @principle Allows public read access for authenticated users, denies all writes.
     */
    match /candidates/{candidateId} {
      allow get, list: if isSignedIn();
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Allows any signed-in user to read Election data. Denies all writes.
     * @path /elections/{electionId}
     * @allow (get, list): if isSignedIn()
     * @deny (create, update, delete): Always.
     * @principle Allows public read access for authenticated users, denies all writes.
     */
    match /elections/{electionId} {
      allow get, list: if isSignedIn();
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Allows any signed-in user to read PollingData. Denies all writes.
     * @path /polling_data/{pollingDataId}
     * @allow (get, list): if isSignedIn()
     * @deny (create, update, delete): Always.
     * @principle Allows public read access for authenticated users, denies all writes.
     */
    match /polling_data/{pollingDataId} {
      allow get, list: if isSignedIn();
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Allows any signed-in user to read Constituency data. Denies all writes.
     * @path /constituencies/{constituencyId}
     * @allow (get, list): if isSignedIn()
     * @deny (create, update, delete): Always.
     * @principle Allows public read access for authenticated users, denies all writes.
     */
    match /constituencies/{constituencyId} {
      allow get, list: if isSignedIn();
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Allows any signed-in user to read ElectionResult data. Denies all writes.
     * @path /election_results/{electionResultId}
     * @allow (get, list): if isSignedIn()
     * @deny (create, update, delete): Always.
     * @principle Allows public read access for authenticated users, denies all writes.
     */
    match /election_results/{electionResultId} {
      allow get, list: if isSignedIn();
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    function isSignedIn() {
      return request.auth != null;
    }
  }
}