rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Checks if the user is signed in.
     * @return {boolean} True if the user is signed in, false otherwise.
     */
    function isSignedIn() {
      return request.auth != null;
    }

    /**
     * @description Allows a user to only access their own resources.
     * @param {string} userId The user ID to check against.
     * @return {boolean} True if the request is made by the specified user, false otherwise.
     */
    function isOwner(userId) {
      return request.auth.uid == userId;
    }

    /**
     * @description Checks if the user is the owner of an existing document.
     * @param {string} userId The user ID to check against.
     * @return {boolean} True if the user is the owner of the existing document, false otherwise.
     */
    function isExistingOwner(userId) {
      return isOwner(userId) && resource != null;
    }

    /**
     * @description Allows create access to authenticated users.
     * @return {boolean} True if the user is authenticated
     */
    function canCreate() {
        return isSignedIn();
    }

    /**
     * @description Allows write access to authenticated users.
     * @return {boolean} True if the user is authenticated
     */
    function canWrite() {
        return isSignedIn();
    }

    // Secure all collections by default
    match /{path=**} {
      allow read: if false;
      allow write: if false;
    }

    match /mailing_list_subscribers/{subscriberId} {
      allow get: if true;
      allow list: if true;
    }

    match /parties/{partyId} {
      allow get: if true;
      allow list: if true;
    }

    match /party_logos/{partyLogoId} {
      allow get: if true;
      allow list: if true;
    }

    match /events/{eventId} {
      allow get: if true;
      allow list: if true;
    }

    match /candidates/{candidateId} {
      allow get: if true;
      allow list: if true;
    }

    match /archived_candidates/{archivedCandidateId} {
      allow get: if true;
      allow list: if true;
    }

    match /elections/{electionId} {
      allow get: if true;
      allow list: if true;
    }

    match /polling_data/{pollingDataId} {
      allow get: if true;
      allow list: if true;
    }

    match /constituencies/{constituencyId} {
      allow get: if true;
      allow list: if true;
    }

    match /election_results/{electionResultId} {
      allow get: if true;
      allow list: if true;
    }

    match /settings/pageLayouts {
      allow get: if true;
    }

    match /settings/site {
      allow get: if true;
    }

    match /user_activity/{activityId} {
      allow create: if canCreate();
    }

    match /regions/{regionId} {
      allow get: if true;
      allow list: if true;
    }

    match /user_maps/{userMapId} {
      allow create: if canCreate();
    }

    match /ads/{adId} {
      allow get: if true;
      allow list: if true;
    }

    match /news/{newsId} {
      allow get: if true;
      allow list: if true;

      match /comments/{commentId} {
        allow create: if canCreate();
      }
    }

    match /reports/{reportId} {
      allow create: if canCreate();
    }
  }
}