/**
 * @fileoverview Firestore Security Rules for Revolucianize Application
 *
 * Core Philosophy:
 * This ruleset prioritizes security by enforcing strict access control based on
 * authentication.  It uses the principle of least privilege, granting access
 * only when explicitly required. It also addresses the error reported in `src/app/constituencies/page.tsx`,
 * where an update operation was denied on the `/settings/pageLayouts` document, by granting access to authenticated users.
 *
 * Data Structure:
 * The Firestore database contains various collections for entities like parties,
 * candidates, elections, constituencies, and user activity.  There are also
 * single documents for global site settings and page layouts located at
 * `/settings/site` and `/settings/pageLayouts`, respectively.
 * All top level collections have randomly generated document IDs.
 *
 * Key Security Decisions:
 * - Authenticated users can update the `/settings/pageLayouts` document.
 * - All other collections are not writable by regular users.
 * - Data shape validation is relaxed to allow for rapid prototyping.
 *
 * Denormalization for Authorization:
 * This ruleset does not rely on denormalization.  All authorization checks are
 * based on user authentication status.
 *
 * Structural Segregation:
 * There is no segregation of public vs. private data. All data is treated as
 * requiring authentication for modification.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Checks if the user is signed in.
     */
    function isSignedIn() {
      return request.auth != null;
    }

    /***** Global Singletons *****/

    /**
     * @description Allows authenticated users to update the page layouts settings.
     * @path /databases/{database}/documents/settings/pageLayouts
     * @allow (update) User is signed in.
     * @deny (update) User is not signed in.
     * @principle Allows update only to authenticated users.
     */
    match /settings/pageLayouts {
      allow read: if true;
      allow create: if false;
      allow update: if isSignedIn();
      allow delete: if false;
    }

    /**
     * @description Allows public read-only access to global site settings.
     * @path /databases/{database}/documents/settings/site
     * @allow (get, list) Anyone can read the site settings.
     * @deny (create, update, delete) No one can modify site settings.
     * @principle Allows public read-only access for site settings.
     */
    match /settings/site {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /***** Top-Level Collections (No Owner) *****/

    /**
     * @description Restricts access to the mailing_list_subscribers collection.
     * @path /databases/{database}/documents/mailing_list_subscribers/{subscriberId}
     * @allow (get, list) No one can read or list subscribers.
     * @deny (create, update, delete) No one can modify subscribers.
     * @principle Protects mailing list subscriber data from unauthorized access.
     */
    match /mailing_list_subscribers/{subscriberId} {
      allow get, list: if false;
      allow create, update, delete: if false;
    }

    /**
     * @description Restricts access to the parties collection.
     * @path /databases/{database}/documents/parties/{partyId}
     * @allow (get, list) No one can read or list parties.
     * @deny (create, update, delete) No one can modify parties.
     * @principle Protects party data from unauthorized access.
     */
    match /parties/{partyId} {
      allow get, list: if false;
      allow create, update, delete: if false;
    }

    /**
     * @description Restricts access to the party_logos collection.
     * @path /databases/{database}/documents/party_logos/{partyLogoId}
     * @allow (get, list) No one can read or list party logos.
     * @deny (create, update, delete) No one can modify party logos.
     * @principle Protects party logo data from unauthorized access.
     */
    match /party_logos/{partyLogoId} {
      allow get, list: if false;
      allow create, update, delete: if false;
    }

    /**
     * @description Restricts access to the events collection.
     * @path /databases/{database}/documents/events/{eventId}
     * @allow (get, list) No one can read or list events.
     * @deny (create, update, delete) No one can modify events.
     * @principle Protects event data from unauthorized access.
     */
    match /events/{eventId} {
      allow get, list: if false;
      allow create, update, delete: if false;
    }

    /**
     * @description Restricts access to the candidates collection.
     * @path /databases/{database}/documents/candidates/{candidateId}
     * @allow (get, list) No one can read or list candidates.
     * @deny (create, update, delete) No one can modify candidates.
     * @principle Protects candidate data from unauthorized access.
     */
    match /candidates/{candidateId} {
      allow get, list: if false;
      allow create, update, delete: if false;
    }

    /**
     * @description Restricts access to the archived_candidates collection.
     * @path /databases/{database}/documents/archived_candidates/{archivedCandidateId}
     * @allow (get, list) No one can read or list archived candidates.
     * @deny (create, update, delete) No one can modify archived candidates.
     * @principle Protects archived candidate data from unauthorized access.
     */
    match /archived_candidates/{archivedCandidateId} {
      allow get, list: if false;
      allow create, update, delete: if false;
    }

    /**
     * @description Restricts access to the elections collection.
     * @path /databases/{database}/documents/elections/{electionId}
     * @allow (get, list) No one can read or list elections.
     * @deny (create, update, delete) No one can modify elections.
     * @principle Protects election data from unauthorized access.
     */
    match /elections/{electionId} {
      allow get, list: if false;
      allow create, update, delete: if false;
    }

    /**
     * @description Restricts access to the polling_data collection.
     * @path /databases/{database}/documents/polling_data/{pollingDataId}
     * @allow (get, list) No one can read or list polling data.
     * @deny (create, update, delete) No one can modify polling data.
     * @principle Protects polling data from unauthorized access.
     */
    match /polling_data/{pollingDataId} {
      allow get, list: if false;
      allow create, update, delete: if false;
    }

    /**
     * @description Restricts access to the constituencies collection.
     * @path /databases/{database}/documents/constituencies/{constituencyId}
     * @allow (get, list) No one can read or list constituencies.
     * @deny (create, update, delete) No one can modify constituencies.
     * @principle Protects constituency data from unauthorized access.
     */
    match /constituencies/{constituencyId} {
      allow get, list: if false;
      allow create, update, delete: if false;
    }

    /**
     * @description Restricts access to the election_results collection.
     * @path /databases/{database}/documents/election_results/{electionResultId}
     * @allow (get, list) No one can read or list election results.
     * @deny (create, update, delete) No one can modify election results.
     * @principle Protects election result data from unauthorized access.
     */
    match /election_results/{electionResultId} {
      allow get, list: if false;
      allow create, update, delete: if false;
    }

    /**
     * @description Restricts access to the user_activity collection.
     * @path /databases/{database}/documents/user_activity/{activityId}
     * @allow (get, list) No one can read or list user activity.
     * @deny (create, update, delete) No one can modify user activity.
     * @principle Protects user activity data from unauthorized access.
     */
    match /user_activity/{activityId} {
      allow get, list: if false;
      allow create, update, delete: if false;
    }

    /**
     * @description Restricts access to the regions collection.
     * @path /databases/{database}/documents/regions/{regionId}
     * @allow (get, list) No one can read or list regions.
     * @deny (create, update, delete) No one can modify regions.
     * @principle Protects region data from unauthorized access.
     */
    match /regions/{regionId} {
      allow get, list: if false;
      allow create, update, delete: if false;
    }

   /**
    * @description Restricts access to the user_maps collection.
    * @path /databases/{database}/documents/user_maps/{userMapId}
    * @allow (get, list) No one can read or list user maps.
    * @deny (create, update, delete) No one can modify user maps.
    * @principle Protects user map data from unauthorized access.
    */
    match /user_maps/{userMapId} {
      allow get, list: if false;
      allow create, update, delete: if false;
    }

    /**
     * @description Restricts access to the ads collection.
     * @path /databases/{database}/documents/ads/{adId}
     * @allow (get, list) No one can read or list ads.
     * @deny (create, update, delete) No one can modify ads.
     * @principle Protects ad data from unauthorized access.
     */
    match /ads/{adId} {
      allow get, list: if false;
      allow create, update, delete: if false;
    }

   /**
    * @description Restricts access to the news collection.
    * @path /databases/{database}/documents/news/{newsId}
    * @allow (get, list) No one can read or list news.
    * @deny (create, update, delete) No one can modify news.
    * @principle Protects news data from unauthorized access.
    */
    match /news/{newsId} {
      allow get, list: if false;
      allow create, update, delete: if false;

        /**
         * @description Restricts access to the news comments collection.
         * @path /databases/{database}/documents/news/{newsId}/comments/{commentId}
         * @allow (get, list) No one can read or list news comments.
         * @deny (create, update, delete) No one can modify news comments.
         * @principle Protects news comment data from unauthorized access.
         */
        match /comments/{commentId} {
            allow get, list: if false;
            allow create, update, delete: if false;
        }
    }

   /**
    * @description Restricts access to the reports collection.
    * @path /databases/{database}/documents/reports/{reportId}
    * @allow (get, list) No one can read or list reports.
    * @deny (create, update, delete) No one can modify reports.
    * @principle Protects report data from unauthorized access.
    */
    match /reports/{reportId} {
        allow get, list: if false;
        allow create, update, delete: if false;
    }
  }
}