/**
 * @file Firestore Security Rules
 * @core This ruleset enforces a strict owner-only access model for most collections.
 * @structure The database consists of several top-level collections: `/users/{userId}`, `/parties/{partyId}`, `/events/{eventId}`, etc.
 * @security Key decisions:
 *   - Users can only create, read, update, and delete their own documents in user-specific collections.
 *   - Listing of documents is generally allowed only for owner-specific subcollections. Top level collections are readable to everyone.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Validates that the user is signed in.
     * @return {bool} True if the user is signed in, false otherwise.
     */
    function isSignedIn() {
      return request.auth != null;
    }

    /**
     * @description Validates that the user is the owner of the document.
     * @param {string} userId The user ID to compare against the request's auth UID.
     * @return {bool} True if the user is the owner, false otherwise.
     */
    function isOwner(userId) {
      return isSignedIn() && request.auth.uid == userId;
    }

    /**
     * @description Validates that the user is the owner of the document and that the document exists.
     * @param {string} userId The user ID to compare against the request's auth UID.
     * @return {bool} True if the user is the owner and the document exists, false otherwise.
     */
    function isExistingOwner(userId) {
      return isOwner(userId) && resource != null;
    }
    
    /**
     * @description Rules for the /mailing_list_subscribers collection.
     * @path /mailing_list_subscribers/{subscriberId}
     * @allow (create) User with valid auth can create a new subscriber document.
     * @deny (create) User tries to create a subscriber document with a mismatched ID.
     * @allow (get) Anyone can read a subscriber document.
     * @allow (list) Anyone can list all subscriber documents.
     * @deny (update) User tries to update a subscriber document.
     * @deny (delete) User tries to delete a subscriber document.
     * @principle Public read, no write access.
     */
    match /mailing_list_subscribers/{subscriberId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Rules for the /parties collection.
     * @path /parties/{partyId}
     * @allow (get) Anyone can read a party document.
     * @allow (list) Anyone can list all party documents.
     * @deny (create) User tries to create a party document.
     * @deny (update) User tries to update a party document.
     * @deny (delete) User tries to delete a party document.
     * @principle Public read, no write access.
     */
    match /parties/{partyId} {
      allow get, list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Rules for the /party_logos collection.
     * @path /party_logos/{partyLogoId}
     * @allow (get) Anyone can read a party logo document.
     * @allow (list) Anyone can list all party logo documents.
     * @allow (create) User with valid auth can create a new party logo document.
     * @deny (update) User tries to update a party logo document.
     * @deny (delete) User tries to delete a party logo document.
     * @principle Public read, owner-only writes.
     */
    match /party_logos/{partyLogoId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Rules for the /events collection.
     * @path /events/{eventId}
     * @allow (get) Anyone can read an event document.
     * @allow (list) Anyone can list all event documents.
     * @deny (create) User tries to create an event document.
     * @deny (update) User tries to update an event document.
     * @deny (delete) User tries to delete an event document.
     * @principle Public read, no write access.
     */
    match /events/{eventId} {
      allow get, list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Rules for the /candidates collection.
     * @path /candidates/{candidateId}
     * @allow (get) Anyone can read a candidate document.
     * @allow (list) Anyone can list all candidate documents.
     * @deny (create) User tries to create a candidate document.
     * @deny (update) User tries to update a candidate document.
     * @deny (delete) User tries to delete a candidate document.
     * @principle Public read, no write access.
     */
    match /candidates/{candidateId} {
      allow get, list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Rules for the /archived_candidates collection.
     * @path /archived_candidates/{archivedCandidateId}
     * @allow (get) Anyone can read an archived candidate document.
     * @allow (list) Anyone can list all archived candidate documents.
     * @deny (create) User tries to create an archived candidate document.
     * @deny (update) User tries to update an archived candidate document.
     * @deny (delete) User tries to delete an archived candidate document.
     * @principle Public read, no write access.
     */
    match /archived_candidates/{archivedCandidateId} {
      allow get, list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Rules for the /elections collection.
     * @path /elections/{electionId}
     * @allow (get) Anyone can read an election document.
     * @allow (list) Anyone can list all election documents.
     * @deny (create) User tries to create an election document.
     * @deny (update) User tries to update an election document.
     * @deny (delete) User tries to delete an election document.
     * @principle Public read, no write access.
     */
    match /elections/{electionId} {
      allow get, list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Rules for the /polling_data collection.
     * @path /polling_data/{pollingDataId}
     * @allow (get) Anyone can read a polling data document.
     * @allow (list) Anyone can list all polling data documents.
     * @deny (create) User tries to create a polling data document.
     * @deny (update) User tries to update a polling data document.
     * @deny (delete) User tries to delete a polling data document.
     * @principle Public read, no write access.
     */
    match /polling_data/{pollingDataId} {
      allow get, list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Rules for the /constituencies collection.
     * @path /constituencies/{constituencyId}
     * @allow (get) Anyone can read a constituency document.
     * @allow (list) Anyone can list all constituency documents.
     * @deny (create) User tries to create a constituency document.
     * @deny (update) User tries to update a constituency document.
     * @deny (delete) User tries to delete a constituency document.
     * @principle Public read, no write access.
     */
    match /constituencies/{constituencyId} {
      allow get, list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Rules for the /election_results collection.
     * @path /election_results/{electionResultId}
     * @allow (get) Anyone can read an election result document.
     * @allow (list) Anyone can list all election result documents.
     * @deny (create) User tries to create an election result document.
     * @deny (update) User tries to update an election result document.
     * @deny (delete) User tries to delete an election result document.
     * @principle Public read, no write access.
     */
    match /election_results/{electionResultId} {
      allow get, list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Rules for the /settings/pageLayouts document.
     * @path /settings/pageLayouts
     * @allow (get) Anyone can read the page layouts document.
     * @deny (list) Listing is not applicable for a single document.
     * @deny (create) User tries to create the page layouts document.
     * @deny (update) User tries to update the page layouts document.
     * @deny (delete) User tries to delete the page layouts document.
     * @principle Public read, no write access.
     */
    match /settings/pageLayouts {
      allow get: if true;
      allow list: if false;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Rules for the /settings/site document.
     * @path /settings/site
     * @allow (get) Anyone can read the site settings document.
     * @deny (list) Listing is not applicable for a single document.
     * @deny (create) User tries to create the site settings document.
     * @deny (update) User tries to update the site settings document.
     * @deny (delete) User tries to delete the site settings document.
     * @principle Public read, no write access.
     */
    match /settings/site {
      allow get: if true;
      allow list: if false;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Rules for the /user_activity collection.
     * @path /user_activity/{activityId}
     * @allow (get) Anyone can read a user activity document.
     * @allow (list) Anyone can list all user activity documents.
     * @deny (create) User tries to create a user activity document.
     * @deny (update) User tries to update a user activity document.
     * @deny (delete) User tries to delete a user activity document.
     * @principle Public read, no write access.
     */
    match /user_activity/{activityId} {
      allow get, list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Rules for the /regions collection.
     * @path /regions/{regionId}
     * @allow (get) Anyone can read a region document.
     * @allow (list) Anyone can list all region documents.
     * @deny (create) User tries to create a region document.
     * @deny (update) User tries to update a region document.
     * @deny (delete) User tries to delete a region document.
     * @principle Public read, no write access.
     */
    match /regions/{regionId} {
      allow get, list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Rules for the /user_maps collection.
     * @path /user_maps/{userMapId}
     * @allow (get) Anyone can read a user map document.
     * @allow (list) Anyone can list all user map documents.
     * @deny (create) User tries to create a user map document.
     * @deny (update) User tries to update a user map document.
     * @deny (delete) User tries to delete a user map document.
     * @principle Public read, no write access.
     */
    match /user_maps/{userMapId} {
      allow get, list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Rules for the /ads collection.
     * @path /ads/{adId}
     * @allow (get) Anyone can read an ad document.
     * @allow (list) Anyone can list all ad documents.
     * @deny (create) User tries to create an ad document.
     * @deny (update) User tries to update an ad document.
     * @deny (delete) User tries to delete an ad document.
     * @principle Public read, no write access.
     */
    match /ads/{adId} {
      allow get, list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Rules for the /news collection.
     * @path /news/{newsId}
     * @allow (get) Anyone can read a news article document.
     * @allow (list) Anyone can list all news article documents.
     * @deny (create) User tries to create a news article document.
     * @deny (update) User tries to update a news article document.
     * @deny (delete) User tries to delete a news article document.
     * @principle Public read, no write access.
     */
    match /news/{newsId} {
      allow get, list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;

       /**
        * @description Rules for the /news/{newsId}/comments collection.
        * @path /news/{newsId}/comments/{commentId}
        * @allow (get) Anyone can read a comment document.
        * @allow (list) Anyone can list all comment documents.
        * @deny (create) User tries to create a comment document.
        * @deny (update) User tries to update a comment document.
        * @deny (delete) User tries to delete a comment document.
        * @principle Public read, no write access.
        */
        match /comments/{commentId} {
          allow get, list: if true;
          allow create: if isSignedIn();
          allow update: if false;
          allow delete: if false;
        }
    }
        /**
         * @description Rules for the /reports collection.
         * @path /reports/{reportId}
         * @allow (get) Anyone can read a report document.
         * @allow (list) Anyone can list all report documents.
         * @deny (create) User tries to create a report document.
         * @deny (update) User tries to update a report document.
         * @deny (delete) User tries to delete a report document.
         * @principle Public read, no write access.
         */
        match /reports/{reportId} {
          allow get, list: if true;
          allow create: if false;
          allow update: if false;
          allow delete: if false;
        }
  }
}