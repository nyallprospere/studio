/**
 * @file Firestore Security Rules
 * @description This ruleset is designed for rapid prototyping and enforces a security model that prioritizes authorization over strict schema validation.
 *
 * Core Philosophy:
 * All write operations are restricted and require authentication. Read operations are generally open unless sensitive data is involved.
 * This allows the application to quickly iterate on data structures without being blocked by overly strict rules during the early stages.
 *
 * Data Structure:
 * The Firestore database consists of several top-level collections, each representing a core data entity:
 * - /mailing_list_subscribers/{subscriberId}: Mailing list subscriptions.
 * - /parties/{partyId}: Political party information.
 * - /party_logos/{partyLogoId}: Election-specific party logos.
 * - /events/{eventId}: Political events.
 * - /candidates/{candidateId}: Candidate information.
 * - /archived_candidates/{archivedCandidateId}: Archived candidate data.
 * - /elections/{electionId}: Election events.
 * - /polling_data/{pollingDataId}: Election polling data.
 * - /constituencies/{constituencyId}: Voting constituency information.
 * - /election_results/{electionResultId}: Election results.
 * - /settings/pageLayouts: Layout settings for the application pages.
 * - /settings/site: Global site settings.
 * - /user_activity/{activityId}: Records of user activity.
 * - /regions/{regionId}: Geographical region definitions.
 * - /user_maps/{userMapId}: User-created prediction maps.
 * - /ads/{adId}: Advertisements.
 * - /news/{newsId}: News articles.
 * - /news/{newsId}/comments/{commentId}: Comments on news articles.
 * - /reports/{reportId}: Reports of inappropriate comments.
 *
 * Key Security Decisions:
 * - Public Read Access: Most collections are configured for public read access to facilitate open data consumption.
 * - Authenticated Writes: All write operations (create, update, delete) require a valid authenticated user.
 * - No User Listing: Listing users is not permitted.
 * - Settings Collections: The `settings` collections are read-only for all users and writes are disabled.
 * - Subcollection Rules: Rules for subcollections (e.g., comments) inherit the parent collection's authentication requirements.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows anyone to read mailing list subscribers but restricts write access to authenticated users.
     * @path /mailing_list_subscribers/{subscriberId}
     * @allow (get, list): if true
     * @allow (create, update, delete): if isSignedIn()
     * @deny (create): if false
     * @deny (update): if false
     * @deny (delete): if false
     * @principle Allows public reads and authenticated writes for mailing list subscriptions.
     */
    match /mailing_list_subscribers/{subscriberId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn() ;
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows anyone to read party information but restricts write access to authenticated users.
     * @path /parties/{partyId}
     * @allow (get, list): if true
     * @allow (create, update, delete): if isSignedIn()
     * @deny (create): if false
     * @deny (update): if false
     * @deny (delete): if false
     * @principle Allows public reads and authenticated writes for party data.
     */
    match /parties/{partyId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows anyone to read party logos but restricts write access to authenticated users.
     * @path /party_logos/{partyLogoId}
     * @allow (get, list): if true
     * @allow (create, update, delete): if isSignedIn()
     * @deny (create): if false
     * @deny (update): if false
     * @deny (delete): if false
     * @principle Allows public reads and authenticated writes for party logos.
     */
    match /party_logos/{partyLogoId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows anyone to read event information but restricts write access to authenticated users.
     * @path /events/{eventId}
     * @allow (get, list): if true
     * @allow (create, update, delete): if isSignedIn()
     * @deny (create): if false
     * @deny (update): if false
     * @deny (delete): if false
     * @principle Allows public reads and authenticated writes for events.
     */
    match /events/{eventId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows anyone to read candidate information but restricts write access to authenticated users.
     * @path /candidates/{candidateId}
     * @allow (get, list): if true
     * @allow (create, update, delete): if isSignedIn()
     * @deny (create): if false
     * @deny (update): if false
     * @deny (delete): if false
     * @principle Allows public reads and authenticated writes for candidates.
     */
    match /candidates/{candidateId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows anyone to read archived candidate data but restricts write access to authenticated users.
     * @path /archived_candidates/{archivedCandidateId}
     * @allow (get, list): if true
     * @allow (create, update, delete): if isSignedIn()
     * @deny (create): if false
     * @deny (update): if false
     * @deny (delete): if false
     * @principle Allows public reads and authenticated writes for archived candidates.
     */
    match /archived_candidates/{archivedCandidateId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows anyone to read election information but restricts write access to authenticated users.
     * @path /elections/{electionId}
     * @allow (get, list): if true
     * @allow (create, update, delete): if isSignedIn()
     * @deny (create): if false
     * @deny (update): if false
     * @deny (delete): if false
     * @principle Allows public reads and authenticated writes for elections.
     */
    match /elections/{electionId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows anyone to read polling data but restricts write access to authenticated users.
     * @path /polling_data/{pollingDataId}
     * @allow (get, list): if true
     * @allow (create, update, delete): if isSignedIn()
     * @deny (create): if false
     * @deny (update): if false
     * @deny (delete): if false
     * @principle Allows public reads and authenticated writes for polling data.
     */
    match /polling_data/{pollingDataId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows anyone to read constituency information but restricts write access to authenticated users.
     * @path /constituencies/{constituencyId}
     * @allow (get, list): if true
     * @allow (create, update, delete): if isSignedIn()
     * @deny (create): if false
     * @deny (update): if false
     * @deny (delete): if false
     * @principle Allows public reads and authenticated writes for constituencies.
     */
    match /constituencies/{constituencyId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows anyone to read election results but restricts write access to authenticated users.
     * @path /election_results/{electionResultId}
     * @allow (get, list): if true
     * @allow (create, update, delete): if isSignedIn()
     * @deny (create): if false
     * @deny (update): if false
     * @deny (delete): if false
     * @principle Allows public reads and authenticated writes for election results.
     */
    match /election_results/{electionResultId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows anyone to read page layouts, but prevents all writes.
     * @path /settings/pageLayouts
     * @allow (get, list): if true
     * @deny (create, update, delete): if true
     * @principle Makes the pageLayouts document publicly readable and prevents any modifications.
     */
    match /settings/pageLayouts {
      allow get, list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Allows anyone to read site settings, but prevents all writes.
     * @path /settings/site
     * @allow (get, list): if true
     * @deny (create, update, delete): if true
     * @principle Makes the site settings document publicly readable and prevents any modifications.
     */
    match /settings/site {
      allow get, list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Allows anyone to read user activity, but restricts write access to authenticated users.
     * @path /user_activity/{activityId}
     * @allow (get, list): if true
     * @allow (create, update, delete): if isSignedIn()
     * @deny (create): if false
     * @deny (update): if false
     * @deny (delete): if false
     * @principle Allows public reads and authenticated writes for user activity data.
     */
    match /user_activity/{activityId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows anyone to read region information but restricts write access to authenticated users.
     * @path /regions/{regionId}
     * @allow (get, list): if true
     * @allow (create, update, delete): if isSignedIn()
     * @deny (create): if false
     * @deny (update): if false
     * @deny (delete): if false
     * @principle Allows public reads and authenticated writes for regions.
     */
    match /regions/{regionId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows anyone to read user maps but restricts write access to authenticated users.
     * @path /user_maps/{userMapId}
     * @allow (get, list): if true
     * @allow (create, update, delete): if isSignedIn()
     * @deny (create): if false
     * @deny (update): if false
     * @deny (delete): if false
     * @principle Allows public reads and authenticated writes for user maps.
     */
    match /user_maps/{userMapId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows anyone to read ad listings but restricts write access to authenticated users.
     * @path /ads/{adId}
     * @allow (get, list): if true
     * @allow (create, update, delete): if isSignedIn()
     * @deny (create): if false
     * @deny (update): if false
     * @deny (delete): if false
     * @principle Allows public reads and authenticated writes for ads.
     */
    match /ads/{adId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows anyone to read news articles but restricts write access to authenticated users.
     * @path /news/{newsId}
     * @allow (get, list): if true
     * @allow (create, update, delete): if isSignedIn()
     * @deny (create): if false
     * @deny (update): if false
     * @deny (delete): if false
     * @principle Allows public reads and authenticated writes for news articles.
     */
    match /news/{newsId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();

      /**
       * @description Allows anyone to read comments on news articles but restricts write access to authenticated users.
       * @path /news/{newsId}/comments/{commentId}
       * @allow (get, list): if true
       * @allow (create, update, delete): if isSignedIn()
       * @deny (create): if false
       * @deny (update): if false
       * @deny (delete): if false
       * @principle Allows public reads and authenticated writes for news article comments.
       */
      match /comments/{commentId} {
        allow get, list: if true;
        allow create: if isSignedIn();
        allow update: if isSignedIn();
        allow delete: if isSignedIn();
      }
    }

    /**
     * @description Allows anyone to read reports but restricts write access to authenticated users.
     * @path /reports/{reportId}
     * @allow (get, list): if true
     * @allow (create, update, delete): if isSignedIn()
     * @deny (create): if false
     * @deny (update): if false
     * @deny (delete): if false
     * @principle Allows public reads and authenticated writes for reports.
     */
    match /reports/{reportId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

  }

  /**
   * @description Checks if the user is signed in.
   * @return {bool} True if the user is signed in, false otherwise.
   * @principle Ensures all write operations are performed by authenticated users.
   */
  function isSignedIn() {
    return request.auth != null;
  }
}