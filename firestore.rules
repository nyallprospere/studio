/**
 * @description This ruleset enforces a security model where all logged-in users can read data,
 *              but writes are generally disallowed. This is suitable for a read-heavy application
 *              where data is managed through a separate administrative interface.
 * @dataStructure The Firestore database consists of several top-level collections:
 *                /parties, /party_logos, /events, /candidates, /archived_candidates, /elections,
 *                /polling_data, /constituencies, /election_results, /settings, /user_activity, and /regions.
 *                The /settings collection contains two single documents: /settings/pageLayouts and /settings/site.
 * @keySecurityDecisions
 *   - All authenticated users can read any data (get, list).
 *   - No create, update, or delete operations are allowed via the client without additional roles.
 *   - No schema validation is performed beyond ensuring authorization.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function to check if the user is signed in
    function isSignedIn() {
      return request.auth != null;
    }

    /**
     * @description Allows any authenticated user to read party data.  Writes are disallowed.
     * @path /parties/{partyId}
     * @allow (get, list) - Any logged-in user can read party data.
     * @deny (create, update, delete) - No user can create, update, or delete party data.
     * @principle Allows public read access to party data for authenticated users.
     */
    match /parties/{partyId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if false;
    }

    /**
     * @description Allows any authenticated user to read party logo data.  Writes are disallowed.
     * @path /party_logos/{partyLogoId}
     * @allow (get, list) - Any logged-in user can read party logo data.
     * @deny (create, update, delete) - No user can create, update, or delete party logo data.
     * @principle Allows public read access to party logo data for authenticated users.
     */
    match /party_logos/{partyLogoId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if false;
    }

    /**
     * @description Allows any authenticated user to read event data.  Writes are disallowed.
     * @path /events/{eventId}
     * @allow (get, list) - Any logged-in user can read event data.
     * @deny (create, update, delete) - No user can create, update, or delete event data.
     * @principle Allows public read access to event data for authenticated users.
     */
    match /events/{eventId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if false;
    }

    /**
     * @description Allows any authenticated user to read candidate data.  Writes are disallowed.
     * @path /candidates/{candidateId}
     * @allow (get, list) - Any logged-in user can read candidate data.
     * @deny (create, update, delete) - No user can create, update, or delete candidate data.
     * @principle Allows public read access to candidate data for authenticated users.
     */
    match /candidates/{candidateId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if false;
    }

    /**
     * @description Allows any authenticated user to read archived candidate data.  Writes are disallowed.
     * @path /archived_candidates/{archivedCandidateId}
     * @allow (get, list) - Any logged-in user can read archived candidate data.
     * @deny (create, update, delete) - No user can create, update, or delete archived candidate data.
     * @principle Allows public read access to archived candidate data for authenticated users.
     */
    match /archived_candidates/{archivedCandidateId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if false;
    }

    /**
     * @description Allows any authenticated user to read election data.  Writes are disallowed.
     * @path /elections/{electionId}
     * @allow (get, list) - Any logged-in user can read election data.
     * @deny (create, update, delete) - No user can create, update, or delete election data.
     * @principle Allows public read access to election data for authenticated users.
     */
    match /elections/{electionId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if false;
    }

    /**
     * @description Allows any authenticated user to read polling data.  Writes are disallowed.
     * @path /polling_data/{pollingDataId}
     * @allow (get, list) - Any logged-in user can read polling data.
     * @deny (create, update, delete) - No user can create, update, or delete polling data.
     * @principle Allows public read access to polling data for authenticated users.
     */
    match /polling_data/{pollingDataId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if false;
    }

    /**
     * @description Allows any authenticated user to read constituency data.  Writes are disallowed.
     * @path /constituencies/{constituencyId}
     * @allow (get, list) - Any logged-in user can read constituency data.
     * @deny (create, update, delete) - No user can create, update, or delete constituency data.
     * @principle Allows public read access to constituency data for authenticated users.
     */
    match /constituencies/{constituencyId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if false;
    }

    /**
     * @description Allows any authenticated user to read election result data.  Writes are disallowed.
     * @path /election_results/{electionResultId}
     * @allow (get, list) - Any logged-in user can read election result data.
     * @deny (create, update, delete) - No user can create, update, or delete election result data.
     * @principle Allows public read access to election result data for authenticated users.
     */
    match /election_results/{electionResultId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if false;
    }

    /**
     * @description Allows any authenticated user to read page layout settings.  Writes are disallowed.
     * @path /settings/pageLayouts
     * @allow (get, list) - Any logged-in user can read page layout settings.
     * @deny (create, update, delete) - No user can create, update, or delete page layout settings.
     * @principle Allows public read access to page layout settings for authenticated users.
     */
    match /settings/pageLayouts {
      allow get, list: if isSignedIn();
      allow create, update, delete: if false;
    }

    /**
     * @description Allows any authenticated user to read site settings.  Writes are disallowed.
     * @path /settings/site
     * @allow (get, list) - Any logged-in user can read site settings.
     * @deny (create, update, delete) - No user can create, update, or delete site settings.
     * @principle Allows public read access to site settings for authenticated users.
     */
    match /settings/site {
      allow get, list: if isSignedIn();
      allow create, update, delete: if false;
    }

    /**
     * @description Allows any authenticated user to read user activity data.  Writes are disallowed.
     * @path /user_activity/{activityId}
     * @allow (get, list) - Any logged-in user can read user activity data.
     * @deny (create, update, delete) - No user can create, update, or delete user activity data.
     * @principle Allows public read access to user activity data for authenticated users.
     */
    match /user_activity/{activityId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if false;
    }
    /**
     * @description Allows any authenticated user to read region data.  Writes are disallowed.
     * @path /regions/{regionId}
     * @allow (get, list) - Any logged-in user can read region data.
     * @deny (create, update, delete) - No user can create, update, or delete region data.
     * @principle Allows public read access to region data for authenticated users.
     */
    match /regions/{regionId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if false;
    }
  }
}