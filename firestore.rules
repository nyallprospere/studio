/**
 * @fileoverview Firestore Security Rules for the St. Lucia Elections Hub application.
 *
 * Core Philosophy:
 * This ruleset prioritizes authorization independence and structural segregation.
 * Each top-level collection is secured independently, avoiding complex hierarchical
 * dependencies and costly `get()` calls within the rules. The rules generally
 * permit read access to all authenticated users but require authentication and
 * authorization for write operations.
 *
 * Data Structure:
 * The database consists of several top-level collections:
 * - /parties/{partyId}: Stores political party information.
 * - /candidates/{candidateId}: Stores candidate information.
 * - /elections/{electionId}: Stores election event information.
 * - /polling_data/{pollingDataId}: Stores polling data for elections.
 * - /constituencies/{constituencyId}: Stores voting district information.
 * - /election_results/{electionResultId}: Stores election results.
 * - /settings/site: Stores global site settings.
 *
 * Key Security Decisions:
 * - No user-specific data trees exist in this model, so ownership patterns are not used.
 * - Read access is broadly permitted for authenticated users to facilitate data discovery.
 * - Write access is generally denied without specific authorization logic (which is not present in the provided schema).
 * - The rules do not implement fine-grained access control (e.g., roles or shared access).
 * - List operations are generally allowed for authenticated users, consistent with the read permissions.
 *
 * Denormalization for Authorization:
 * This ruleset avoids the need for denormalization because it does not implement any complex
 * authorization schemes. Each collection is treated as independently accessible.
 *
 * Structural Segregation:
 * The data is segregated into distinct collections based on entity type and access needs.
 * There are no private user subcollections or mixed-access collections in this data model.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    function isSignedIn() {
      return request.auth != null;
    }

    /**
     * @description Grants read access to the site settings document for authenticated users, but denies all write access.
     * @path /settings/site
     * @allow (get, list) - Authenticated user can read site settings.
     * @deny (create, update, delete) - No one can modify site settings through direct writes.
     * @principle Allows public read access for settings, with no write access permitted.
     */
    match /settings/site {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Allows any authenticated user to read party data.  No write access is granted.
     * @path /parties/{partyId}
     * @allow (get, list) - Authenticated user can read party data.
     * @deny (create, update, delete) - No one can create, update, or delete party data through direct writes.
     * @principle Allows public read access for party information, with no write access permitted.
     */
    match /parties/{partyId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Allows any authenticated user to read candidate data.  No write access is granted.
     * @path /candidates/{candidateId}
     * @allow (get, list) - Authenticated user can read candidate data.
     * @deny (create, update, delete) - No one can create, update, or delete candidate data through direct writes.
     * @principle Allows public read access for candidate information, with no write access permitted.
     */
    match /candidates/{candidateId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Allows any authenticated user to read election data.  No write access is granted.
     * @path /elections/{electionId}
     * @allow (get, list) - Authenticated user can read election data.
     * @deny (create, update, delete) - No one can create, update, or delete election data through direct writes.
     * @principle Allows public read access for election information, with no write access permitted.
     */
    match /elections/{electionId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Allows any authenticated user to read polling data.  No write access is granted.
     * @path /polling_data/{pollingDataId}
     * @allow (get, list) - Authenticated user can read polling data.
     * @deny (create, update, delete) - No one can create, update, or delete polling data through direct writes.
     * @principle Allows public read access for polling data, with no write access permitted.
     */
    match /polling_data/{pollingDataId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Allows any authenticated user to read constituency data.  No write access is granted.
     * @path /constituencies/{constituencyId}
     * @allow (get, list) - Authenticated user can read constituency data.
     * @deny (create, update, delete) - No one can create, update, or delete constituency data through direct writes.
     * @principle Allows public read access for constituency information, with no write access permitted.
     */
    match /constituencies/{constituencyId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Allows any authenticated user to read election result data.  No write access is granted.
     * @path /election_results/{electionResultId}
     * @allow (get, list) - Authenticated user can read election result data.
     * @deny (create, update, delete) - No one can create, update, or delete election result data through direct writes.
     * @principle Allows public read access for election result information, with no write access permitted.
     */
    match /election_results/{electionResultId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }
  }
}