/**
 * @fileoverview Firestore Security Rules for the political data web application.
 *
 * Core Philosophy:
 * This ruleset prioritizes security by enforcing strict access control to different data collections based on the entities defined in the schema.
 * It uses a combination of public read access for some collections and authenticated user-based ownership for others.
 *
 * Data Structure:
 * The Firestore database is structured into several top-level collections, each representing a specific entity (e.g., parties, candidates, elections).
 * Some collections have subcollections (e.g., comments under news articles).
 * There are no user-specific data trees (e.g., /users/{userId}/...).
 *
 * Key Security Decisions:
 * - **Public Read Access**:  Collections like `parties`, `candidates`, `elections`, `constituencies`, `news`, and `ads` are publicly readable to allow for open data access.
 * - **Owner-Only Writes**:  Write access to the publicly readable collections is restricted and depends on the existence of an ownership field in each document.
 * - **Mailing List**: Mailing list subscriptions are open for creation, reflecting a typical signup process.
 * - **Reports Collection**: The `reports` collection is locked down, as there is no specified user access, so it defaults to no read or write for any user.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows anyone to read mailing list subscriptions and any authenticated user to create them.
     * @path /mailing_list_subscribers/{subscriberId}
     * @allow (create) User with any valid auth can subscribe.
     * @deny (update, delete) No one can update or delete a subscription.
     * @principle Allows open subscription to the mailing list.
     */
    match /mailing_list_subscribers/{subscriberId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update, delete: if false;
    }

    /**
     * @description Allows anyone to read party information, but restricts modifications.
     * @path /parties/{partyId}
     * @allow (get, list) Any user can read party information.
     * @deny (create, update, delete) No user can create, update, or delete party information.
     * @principle Read access is public, write access is restricted.
     */
    match /parties/{partyId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read party logos, but restricts modifications.
     * @path /party_logos/{partyLogoId}
     * @allow (get, list) Any user can read party logos.
     * @deny (create, update, delete) No user can create, update, or delete party logos.
     * @principle Read access is public, write access is restricted.
     */
    match /party_logos/{partyLogoId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read event information, but restricts modifications.
     * @path /events/{eventId}
     * @allow (get, list) Any user can read event information.
     * @deny (create, update, delete) No user can create, update, or delete event information.
     * @principle Read access is public, write access is restricted.
     */
    match /events/{eventId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read candidate information, but restricts modifications.
     * @path /candidates/{candidateId}
     * @allow (get, list) Any user can read candidate information.
     * @deny (create, update, delete) No user can create, update, or delete candidate information.
     * @principle Read access is public, write access is restricted.
     */
    match /candidates/{candidateId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read archived candidate information, but restricts modifications.
     * @path /archived_candidates/{archivedCandidateId}
     * @allow (get, list) Any user can read archived candidate information.
     * @deny (create, update, delete) No user can create, update, or delete archived candidate information.
     * @principle Read access is public, write access is restricted.
     */
    match /archived_candidates/{archivedCandidateId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read election information, but restricts modifications.
     * @path /elections/{electionId}
     * @allow (get, list) Any user can read election information.
     * @deny (create, update, delete) No user can create, update, or delete election information.
     * @principle Read access is public, write access is restricted.
     */
    match /elections/{electionId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read polling data, but restricts modifications.
     * @path /polling_data/{pollingDataId}
     * @allow (get, list) Any user can read polling data.
     * @deny (create, update, delete) No user can create, update, or delete polling data.
     * @principle Read access is public, write access is restricted.
     */
    match /polling_data/{pollingDataId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read constituency information, but restricts modifications.
     * @path /constituencies/{constituencyId}
     * @allow (get, list) Any user can read constituency information.
     * @deny (create, update, delete) No user can create, update, or delete constituency information.
     * @principle Read access is public, write access is restricted.
     */
    match /constituencies/{constituencyId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read election result information, but restricts modifications.
     * @path /election_results/{electionResultId}
     * @allow (get, list) Any user can read election result information.
     * @deny (create, update, delete) No user can create, update, or delete election result information.
     * @principle Read access is public, write access is restricted.
     */
    match /election_results/{electionResultId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read the page layouts document, but restricts modifications.
     * @path /settings/pageLayouts
     * @allow (get) Any user can read the page layouts.
     * @deny (list, create, update, delete) No user can list, create, update, or delete the page layouts.
     * @principle Read access is public, write access is restricted, and it's a single document.
     */
    match /settings/pageLayouts {
      allow get: if true;
      allow list, create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read the site settings document, but restricts modifications.
     * @path /settings/site
     * @allow (get) Any user can read the site settings.
     * @deny (list, create, update, delete) No user can list, create, update, or delete the site settings.
     * @principle Read access is public, write access is restricted, and it's a single document.
     */
    match /settings/site {
      allow get: if true;
      allow list, create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read user activity events, but restricts modifications.
     * @path /user_activity/{activityId}
     * @allow (get, list) Any user can read user activity events.
     * @deny (create, update, delete) No user can create, update, or delete user activity events.
     * @principle Read access is public, write access is restricted.
     */
    match /user_activity/{activityId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read region information, but restricts modifications.
     * @path /regions/{regionId}
     * @allow (get, list) Any user can read region information.
     * @deny (create, update, delete) No user can create, update, or delete region information.
     * @principle Read access is public, write access is restricted.
     */
    match /regions/{regionId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read user maps, but restricts modifications.
     * @path /user_maps/{userMapId}
     * @allow (get, list) Any user can read user maps.
     * @deny (create, update, delete) No user can create, update, or delete user maps.
     * @principle Read access is public, write access is restricted.
     */
    match /user_maps/{userMapId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read ad listings, but restricts modifications.
     * @path /ads/{adId}
     * @allow (get, list) Any user can read ad listings.
     * @deny (create, update, delete) No user can create, update, or delete ad listings.
     * @principle Read access is public, write access is restricted.
     */
    match /ads/{adId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read news articles, but restricts modifications.
     * @path /news/{newsId}
     * @allow (get, list) Any user can read news articles.
     * @deny (create, update, delete) No user can create, update, or delete news articles.
     * @principle Read access is public, write access is restricted.
     */
    match /news/{newsId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read news article comments, but restricts modifications.
     * @path /news/{newsId}/comments/{commentId}
     * @allow (get, list) Any user can read news article comments.
     * @deny (create, update, delete) No user can create, update, or delete news article comments.
     * @principle Read access is public, write access is restricted.
     */
    match /news/{newsId}/comments/{commentId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

      /**
       * @description Restricts access to reports.
       * @path /reports/{reportId}
       * @deny (get, list, create, update, delete) No user can create, update, or delete reports.
       * @principle No access allowed, due to the lack of access control information.
       */
    match /reports/{reportId} {
        allow get, list, create, update, delete: if false;
    }

  }

  // Helper function to determine if a user is signed in.
  function isSignedIn() {
    return request.auth != null;
  }

}